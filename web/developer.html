<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Developer Guide</title>
    
        <!-- Bootstrap framework -->
            <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
            <link rel="stylesheet" href="bootstrap/css/bootstrap-responsive.min.css" />
        <!-- gebo blue theme-->
            <link rel="stylesheet" href="css/blue.css" />
        <!-- tooltips-->
            <link rel="stylesheet" href="lib/qtip2/jquery.qtip.min.css" />
        <!-- main styles -->
            <link rel="stylesheet" href="css/style.css" />
			
            <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans" />
	
        <!-- Favicon -->
            <link rel="shortcut icon" href="favicon.ico" />
		
        <!--[if lte IE 8]>
            <link rel="stylesheet" href="css/ie.css" />
            <script src="js/ie/html5.js"></script>
			<script src="js/ie/respond.min.js"></script>
        <![endif]-->
		
		<script>
			//* hide all elements & show preloader
			document.documentElement.className += 'js';
		</script>
    </head>
    <body>
		<div id="loading_layer" style="display:none"><img src="img/ajax_loader.gif" alt="" /></div>
		<div id="maincontainer" class="clearfix">
			<!-- header -->

            <header>
                <div class="navbar navbar-fixed-top">
                    <div class="navbar-inner">
                        <div class="container-fluid">
                            <a class="brand" href="#"><i class="icon-home icon-white"></i> Developer Guide</a>
<!-- 
                            <ul class="nav user_menu pull-right">
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Username <b class="caret"></b></a>
                                    <ul class="dropdown-menu">
										<li><a href="#">Action</a></li>
										<li><a href="#">Another Action</a></li>
										<li class="divider"></li>
										<li><a href="#">Another Action</a></li>
                                    </ul>
                                </li>
                            </ul>
                            <ul class="nav" id="mobile-nav">
								<li class="dropdown">
									<a data-toggle="dropdown" class="dropdown-toggle" href="#"> menu <b class="caret"></b></a>
									<ul class="dropdown-menu">
										<li><a href="#">menu section</a></li>
										<li><a href="#">menu section</a></li>
										<li><a href="#">menu section</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a data-toggle="dropdown" class="dropdown-toggle" href="#"> menu <b class="caret"></b></a>
									<ul class="dropdown-menu">
										<li><a href="#">menu section</a></li>
										<li><a href="#">menu section</a></li>
										<li><a href="#">menu section</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a data-toggle="dropdown" class="dropdown-toggle" href="#"> menu <b class="caret"></b></a>
									<ul class="dropdown-menu">
										<li><a href="#">menu section</a></li>
										<li><a href="#">menu section</a></li>
										<li><a href="#">menu section</a></li>
									</ul>
								</li>
							</ul>
 -->                            
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- main content -->
            <div id="contentwrapper">
                <div class="main_content">
                <!-- article -->
                    <div class="row-fluid">
                        <div class="span12">
                            <h4 class="heading">目录结构</h4>
                            <p>所有代码位于\chaoyan\src\Na\StoreBundle. 我们需要修改的目录包括Controller, Form, Resources. </p>
                            <dl>
                                <dt>Controlelr</dt>
                                <dd>Controller里的是php代码，描述的是行为动作</dd>
                                <dt>Form</dt>
                                <dd>Form里也是php代码, 需要做一些修改定制; 描述的是表单的参数</dd>
                                <dt>Resources</dt>
                                <dd>Resources里最重要的是view目录, 里面是twig模板, 只需要修改, 添加自己模块的模板.</dd>
                            </dl>
                        </div>
                    </div>

                <!-- article -->
                    <div class="row-fluid">

                        <div class="span12">
                            <h4 class="heading">面向数据操作的代码架构</h4>
                            <p>基于数据库的系统开发, 简单说就是对数据的增删改查. 开发的第一步就是要把每个表的增删改查4个动作都实现了,这包括添加controller和controller中的动作(action), 和要用到的view(form其实就是view的一部分) </p>
                            <pre><a href="http://diagrams.seaquail.net/Diagram.aspx?ID=4127">数据库图表</a> </pre>

                        </div>
                    </div>
                <!-- article -->
                    <div class="row-fluid">
                        <div class="span12">
                            <h4 class="heading">准备工作</h4>
                            <ol>
                                <li><span class="label label-info">创建数据库</span><pre class="prettyprint linenums">php app\console propel:database:create</pre></li>
                                <li>
                                    <span class="label label-info">创建表</span>
                                    <pre class="prettyprint linenums">php app\console propel:build --insert-sql</pre>
                                </li>
                            </ol>
                       </div>
                   </div>

                <!-- article -->
                    <div class="row-fluid">
                        <div class="span12">
                            <h4 class="heading">如何添加一个action</h4>
                            <p>action指的就是动作(CURD), 每个模块都涉及若干个表, 每个表都要有CURD, 4个action </p>
                            
                            <dl>
                                <dt>Controller</dt>
                                <dd>每个表对应一个controller, 通过实现controller里的CURD函数来完成我们需要的action</dd>
                                <dt><a href="http://symfony.com/doc/master/book/forms.html">Form</a></dt>
                                <dd>一般new, update, 需要用到Form，这个form也是web里的'表单', 我们定义一个form是为了代码复用(new, update都需要)</dd>
                                <dt><a href="http://symfony.com/doc/master/book/templating.html">Twig</a></dt>
                                <dd>twig是用户能看到的样子, 基本就是html的文件, 得益于twig的技术和form的复用使得我们新建一个UI变得非常容易.</dd>
                                <dt><a href="http://symfony.com/doc/master/book/routing.html">Routing</a></dt>
                                <dd>routing其实就是url, 浏览器地址栏里的看到的地址. 每个action都要对应一个url(或者叫routing)</dd>
                            </dl>
                            <p>
                                <blockquote>
                                    代码中customer的new action已经基本完成, 可以参考<br/>"chaoyan\src\Na\CustomerBundle\Controller\CustomerController.php" (新增, 并实现CURD函数)<br>
                                    "chaoyan\src\Na\CustomerBundle\Form\Type\CustomerType.php"(修改, buildForm函数)<br>
                                    "chaoyan\src\Na\CustomerBundle\Resources\views\Customer\new.html.twig" (新增)<br/>
                                    "chaoyan\src\Na\CustomerBundle\Resources\config\routing.yml" (修改, 添加routing规则)
                                </blockquote>
                                <pre>效果 <a href="http://localhost/chaoyan/web/app_dev.php/customer/new">http://localhost/chaoyan/web/app_dev.php/customer/new</a></pre>
                            </p>

                        </div>
                    </div>

                <!-- article -->
                    <div class="row-fluid">
                        <div class="span12">
                            <h4 class="heading">如何更新数据库</h4>
                            <p>每次schema修改了,都要最数据库做下migration. 命令如下</p>
                            <p><span class="label label-info">生成diff</span></p>
                            <pre class="prettyprint linenums">php app\console propel:migration:generate-diff</pre>
                            <p><span class="label label-info">migrate</span></p>
                            <pre class="prettyprint linenums">php app\console propel:migration:migrate</pre>
                        </div>
                    </div>

                <!-- article -->
                    <div class="row-fluid">
                        <div class="span12">
                            <h4 class="heading">生成Model, Form</h4>
                            <p>symfony通过schema生成对应的Model和Form, 所以每次schema修改了,都要重新生成一次Model和Form. 命令如下</p>
                            <p><span class="label label-info">生成Model</span></p>
                            <pre class="prettyprint linenums">php app/console propel:model:build</pre>
                            <p><span class="label label-info">生成Form</span></p>
                            <pre class="prettyprint linenums">php app/console propel:form:generate @NaStaffBundle @NaBillingBundle @NaStoreBundle @NaServiceBundle @NaCustomerBundle @NaAdminBundle @NaAppointmentBundle</pre>
                        </div>
                    </div>

                <!-- article -->
                    <div class="row-fluid">
                        <div class="span12">
                            <h4 class="heading">创建登录用户 <small class="badge badge-important">new</small></h4>
                            <p>博妍系统自从r109开始采用<a href="https://github.com/FriendsOfSymfony/FOSUserBundle">FOSUserBundle</a>实现登录用户的管理</p>
                            <p>使用前务必update下数据库,然后用下面的命令创建登录用户</p>
                            <p><span class="label label-info">创建名为adminuser的管理员</span></p>
                            <pre class="prettyprint linenums">$ php app/console fos:user:create adminuser --super-admin</pre>
                            <p><span class="label label-info">创建testuser普通用户</span></p>
                            <pre class="prettyprint linenums">$ php app/console fos:user:create testuser</pre>
                        </div>
                    </div>
                <!-- article -->
                    <div class="row-fluid">
                        <div class="span12">
                            <h4 class="heading">Reference</h4>
                            <ul>
                                <li>
                                    <a href="http://symfony.com/doc/master/book/index.html">symfony book</a>
                                </li>
                                <li><a href="http://symfony.com/doc/current/cookbook/index.html">symfony cook book</a></li>
                                <li>
                                    <a href="http://symfony.com/doc/master/reference/index.html">symfony reference</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
			<!-- sidebar -->
<!--             
            <a href="javascript:void(0)" class="sidebar_switch on_switch ttip_r" title="Hide Sidebar">Sidebar switch</a>
            <div class="sidebar">
				<div class="antiScroll">
					<div class="antiscroll-inner">
						<div class="antiscroll-content">
							<div class="sidebar_inner">
								<form action="search_page.html" class="input-append" method="post" >
									<input autocomplete="off" name="query" class="search_query input-medium" size="16" type="text" placeholder="Search..." /><button type="submit" class="btn"><i class="icon-search"></i></button>
								</form>
								<div id="side_accordion" class="accordion">
									
									<div class="accordion-group">
										<div class="accordion-heading">
											<a href="#collapseOne" data-parent="#side_accordion" data-toggle="collapse" class="accordion-toggle">
												Section
											</a>
										</div>
										<div class="accordion-body collapse" id="collapseOne">
											<div class="accordion-inner">
												<ul class="nav nav-list">
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
												</ul>
											</div>
										</div>
									</div>
									<div class="accordion-group">
										<div class="accordion-heading">
											<a href="#collapseTwo" data-parent="#side_accordion" data-toggle="collapse" class="accordion-toggle">
												Section
											</a>
										</div>
										<div class="accordion-body collapse" id="collapseTwo">
											<div class="accordion-inner">
												<ul class="nav nav-list">
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
												</ul>
											</div>
										</div>
									</div>
									<div class="accordion-group">
										<div class="accordion-heading">
											<a href="#collapseThree" data-parent="#side_accordion" data-toggle="collapse" class="accordion-toggle">
												Section
											</a>
										</div>
										<div class="accordion-body collapse" id="collapseThree">
											<div class="accordion-inner">
												<ul class="nav nav-list">
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
												</ul>
											</div>
										</div>
									</div>
									<div class="accordion-group">
										<div class="accordion-heading">
											<a href="#collapseFour" data-parent="#side_accordion" data-toggle="collapse" class="accordion-toggle">
												Section
											</a>
										</div>
										<div class="accordion-body collapse in" id="collapseFour">
											<div class="accordion-inner">
												<ul class="nav nav-list">
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
													<li><a href="javascript:void(0)">Side menu</a></li>
												</ul>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
 -->            
            <script src="js/jquery.min.js"></script>
			<!-- smart resize event -->
			<script src="js/jquery.debouncedresize.min.js"></script>
			<!-- hidden elements width/height -->
			<script src="js/jquery.actual.min.js"></script>
			<!-- js cookie plugin -->
			<script src="js/jquery_cookie.min.js"></script>
			<!-- main bootstrap js -->
			<script src="bootstrap/js/bootstrap.min.js"></script>
            <script src="lib/google-code-prettify/prettify.min.js"></script>
			<!-- tooltips -->
			<script src="lib/qtip2/jquery.qtip.min.js"></script>
			<!-- fix for ios orientation change -->
			<script src="js/ios-orientationchange-fix.js"></script>
			<!-- scrollbar -->
			<script src="lib/antiscroll/antiscroll.js"></script>
			<script src="lib/antiscroll/jquery-mousewheel.js"></script>
			<!-- mobile nav -->
			<script src="js/selectNav.js"></script> 
			<!-- common functions -->
			<script src="js/gebo_common.js"></script>
	
			<script>
				$(document).ready(function() {
					//* show all elements & remove preloader
					setTimeout('$("html").removeClass("js")',1000);
				});
			</script>
		
		</div>
	</body>
</html>